<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

  <meta name="description" content="Personal blog about IT, Electronics, InfoSec, Hacking, Bug Hunting...">
  <meta name="keywords" content="Blog, Computer Science, IT, Electronics, Hacking, InfoSec, CTF, Bug Bounty, Open Source">
  <meta name="author" content="Paul-Emmanuel Raoul">

  
  <link rel="apple-touch-icon" sizes="180x180" href="&#x2F;favicon&#x2F;apple-touch-icon.png" />
  
  
  <link rel="icon" type="image/png" sizes="16x16" href="&#x2F;favicon&#x2F;favicon-16x16.png" />
  
  
  <link rel="icon" type="image/png" sizes="32x32" href="&#x2F;favicon&#x2F;favicon-32x32.png" />
  
  
  <link rel="manifest" href="&#x2F;favicon&#x2F;site.webmanifest" />
  

  <title>Skyper&#x27;s blog</title>

  <link rel="stylesheet" href="https://blog.skyplabs.net/css/style.css">

  
  <script defer data-domain="blog.skyplabs.net" src="https://plausible.io/js/plausible.js"></script>
  

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <link rel="alternate" type="application/atom+xml" title="RSS" href="https://blog.skyplabs.net/atom.xml">
</head>
<body vocab="http://schema.org/" typeof="Blog">
  
  <div class="sidebar">
    <div class="container sidebar-sticky">
      <div class="sidebar-about">
        <h1><a href="https://blog.skyplabs.net">Skyper&#x27;s blog</a></h1>
        <p class="lead">Personal blog about IT, Electronics, InfoSec, Hacking, Bug Hunting...</p>
      </div>

      <div class="sidebar-links">
        
        <a class="icon-github" href="https://github.com/SkypLabs" title="GitHub" target="_blank" rel="noopener noreferrer"></a>
        

        
        <a class="icon-docker-hub" href="https://hub.docker.com/u/skyplabs" title="Docker Hub" target="_blank" rel="noopener noreferrer"></a>
        

        
        
        
        <a class="icon-mastodon" href="https://fosstodon.org/@Skyper" title="Mastodon" target="_blank" rel="me noopener noreferrer"></a>
        

        
        <a class="icon-twitter" href="https://twitter.com/SkypLabs" title="Twitter" target="_blank" rel="noopener noreferrer"></a>
        

        
        <a class="icon-linkedin" href="https://www.linkedin.com/in/peraoul" title="LinkedIn" target="_blank" rel="noopener noreferrer"></a>
        

        
        <a class="icon-keybase" href="https://keybase.io/skyplabs" title="Keybase" target="_blank" rel="noopener noreferrer"></a>
        

        
        <a class="icon-email" href="mailto:skyper@skyplabs.net" title="Email"></a>
        

        <a class="icon-rss" href="https://blog.skyplabs.net/atom.xml" title="RSS"></a>
      </div>

      <nav class="sidebar-nav">
        <a class="sidebar-nav-item active" href="/">Home</a>
        
        
        <a class="sidebar-nav-item" href="/publications/">Publications</a>
        
        <a class="sidebar-nav-item" href="/about/">About me</a>
        
        <a class="sidebar-nav-item" href="/contact/">Contact</a>
        
        <a class="sidebar-nav-item" href="/support/">Support me</a>
        
      </nav>
    </div>
  </div>
  

  <div class="content container">
    
    <div id="search-container">
      <input type="search" id="search-input" placeholder="Search for a post, a tag, a category...">
      <div class="search-results">
        <ul class="search-results-items"></ul>
      </div>
    </div>

    <div class="posts">
      
      <article class="post" property="blogPost" typeof="BlogPosting">
        
  <div class="post-meta">
    
    <h2 class="post-title" property="headline">
      <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;posts&#x2F;container-detection&#x2F;">
        Detect whether you are inside a container or not
      </a>
    </h2>
    

    <time class="post-date" datetime="2023-07-27 00:00"
      property="datePublished">27 Jul 2023</time>
    <div class="post-author" property="author" typeof="Person" hidden>
      <span property="name">Paul-Emmanuel Raoul</span>
      <span property="givenName">Paul-Emmanuel</span>
      <span property="familyName">Raoul</span>
      <span property="alternateName">Skyper</span>
      <span property="email">skyper@skyplabs.net</span>
    </div>
  </div>


        
        <div class="post-content" property="description">
          <p>Container technologies (<a rel="noopener nofollow noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/chroot">chroot</a>, <a rel="noopener nofollow noreferrer" target="_blank" href="https://linuxcontainers.org/">LXC</a>, …) are very common these
days, especially since the massive adoption of <a rel="noopener nofollow noreferrer" target="_blank" href="https://www.docker.com/">Docker</a>.</p>
<p>One of the use cases of container technologies is to isolate services from each
others and from the host system. As a result, in case of an intrusion, the
attacker would be in theory trapped inside a container. From the attacker’s
perspective, it is important to be able to detect if a compromised service lives
in a restricted environment such as a Docker container or if it runs directly on
the host operating system.</p>
<p>One way to do so is to have a look at the <a rel="noopener nofollow noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Inode">inode</a> of the <code>/</code> mount point
(<code>ls -id /</code>).  On the host system it will be very low (generally 1 or 2) whereas
in a container it will generally be quite high (4851522 in the asciicast):</p>
<script id="asciicast-318880" src="https://asciinema.org/a/318880.js" async></script>

        </div>

        <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;posts&#x2F;container-detection&#x2F;">Read more</a>
        

        
  
  <span class="categories" property="keywords">
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;categories&#x2F;security&#x2F;">Security</a>
     · 
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;categories&#x2F;sysadmin&#x2F;">SysAdmin</a>
    
    
  </span>
  

  
  <span class="tags" property="keywords">
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;tags&#x2F;container&#x2F;">Container</a>
     · 
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;tags&#x2F;docker&#x2F;">Docker</a>
    
    
  </span>
  

      </article>
      
      <article class="post" property="blogPost" typeof="BlogPosting">
        
  <div class="post-meta">
    
    <h2 class="post-title" property="headline">
      <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;posts&#x2F;vpn-security-improper-http-redirects&#x2F;">
        VPN, Security and Improper HTTP Redirects
      </a>
    </h2>
    

    <time class="post-date" datetime="2023-01-28 00:00"
      property="datePublished">28 Jan 2023</time>
    <div class="post-author" property="author" typeof="Person" hidden>
      <span property="name">Paul-Emmanuel Raoul</span>
      <span property="givenName">Paul-Emmanuel</span>
      <span property="familyName">Raoul</span>
      <span property="alternateName">Skyper</span>
      <span property="email">skyper@skyplabs.net</span>
    </div>
  </div>


        
        <div class="post-content" property="description">
          <p>As you probably have already noticed, the number of VPN providers has grown
massively in the recent years, and you can now stumble on ads for VPN
subscriptions on every corner of the Internet. Of course, not all of these
providers are equal in terms of quality of service, security or privacy. At the
contrary, some of them falsely claim to have a zero-log policy or to even
protect you from malicious actors.</p>
<p>Having said that, using a public VPN service is not necessarily a bad idea if
you choose it correctly. It's a matter of trust after all. Who do you trust the
most for keeping your traffic private, your ISP, or a carefully selected VPN
provider? (I said carefully here because you have a larger number of VPN
providers on the market than ISPs available where you live).</p>
<p>If you trust your VPN provider, you get in theory a higher degree of online
privacy by proxying your connections through it (even if, as of today, nothing
can fully replace <a rel="noopener nofollow noreferrer" target="_blank" title="The Tor project" href="https://www.torproject.org/">Tor</a>). But what about security? From a theoretical
standpoint once again, TLS is well enough to guarantee the security of your
online activity. And thanks to projects like <a rel="noopener nofollow noreferrer" target="_blank" title="Let's Encrypt" href="https://letsencrypt.org/">Let's Encrypt</a>, most
websites are accessible via HTTPS these days.</p>

        </div>

        <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;posts&#x2F;vpn-security-improper-http-redirects&#x2F;">Read more</a>
        

        
  
  <span class="categories" property="keywords">
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;categories&#x2F;essay&#x2F;">Essay</a>
     · 
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;categories&#x2F;security&#x2F;">Security</a>
     · 
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;categories&#x2F;web&#x2F;">Web</a>
    
    
  </span>
  

  
  <span class="tags" property="keywords">
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;tags&#x2F;firefox&#x2F;">Firefox</a>
     · 
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;tags&#x2F;tls&#x2F;">TLS</a>
     · 
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;tags&#x2F;vpn&#x2F;">VPN</a>
    
    
  </span>
  

      </article>
      
      <article class="post" property="blogPost" typeof="BlogPosting">
        
  <div class="post-meta">
    
    <h2 class="post-title" property="headline">
      <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;posts&#x2F;qubes-os-docker-storage&#x2F;">
        [Qubes OS] Make Docker use private storage
      </a>
    </h2>
    

    <time class="post-date" datetime="2023-01-20 00:00"
      property="datePublished">20 Jan 2023</time>
    <div class="post-author" property="author" typeof="Person" hidden>
      <span property="name">Paul-Emmanuel Raoul</span>
      <span property="givenName">Paul-Emmanuel</span>
      <span property="familyName">Raoul</span>
      <span property="alternateName">Skyper</span>
      <span property="email">skyper@skyplabs.net</span>
    </div>
  </div>


        
        <div class="post-content" property="articleBody">
          <p>The Docker engine stores all image layers in <code>/var/lib/docker</code> by default, which
is not compatible with Qubes OS' template system. You would lose all your saved
images each time you restart the app qube in question.</p>
<p>You can change the Docker engine's root data directory by editing
<code>/etc/docker/daemon.json</code> in your template:</p>
<pre data-lang="json" style="background-color:#2b303b;color:#c0c5ce;" class="language-json "><code class="language-json" data-lang="json"><span>{
</span><span>  &quot;</span><span style="color:#a3be8c;">data-root</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">/usr/local/lib/docker</span><span>&quot;
</span><span>}
</span></code></pre>
<p>The list of the directories that can be used to store Docker's data persistently
across reboots can be found <a rel="noopener nofollow noreferrer" target="_blank" title="Qubes OS - Inheritance and Persistence" href="https://www.qubes-os.org/doc/templates/#inheritance-and-persistence">here</a>.</p>
<p>Once the configuration file in place in your template, you can then boot up any
app qube using this template and check if the new location has correctly been
taken into account:</p>
<pre data-lang="raw" style="background-color:#2b303b;color:#c0c5ce;" class="language-raw "><code class="language-raw" data-lang="raw"><span>$ sudo docker info | grep -i &#39;root dir&#39;
</span><span> Docker Root Dir: /usr/local/lib/docker
</span></code></pre>
<p>Please note that if you already had Docker images stored in an qube app before
making this configuration change, they won't be available in Docker any more.
You would need to move them to the new location or download them again.</p>

        </div>
        

        
  
  <span class="categories" property="keywords">
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;categories&#x2F;sysadmin&#x2F;">SysAdmin</a>
    
    
  </span>
  

  
  <span class="tags" property="keywords">
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;tags&#x2F;qubes-os&#x2F;">Qubes OS</a>
     · 
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;tags&#x2F;docker&#x2F;">Docker</a>
    
    
  </span>
  

      </article>
      
      <article class="post" property="blogPost" typeof="BlogPosting">
        
  <div class="post-meta">
    
    <h2 class="post-title" property="headline">
      <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;posts&#x2F;codeql-lsp-vim&#x2F;">
        [Vim] Set up CodeQL LSP
      </a>
    </h2>
    

    <time class="post-date" datetime="2022-07-10 00:00"
      property="datePublished">10 Jul 2022</time>
    <div class="post-author" property="author" typeof="Person" hidden>
      <span property="name">Paul-Emmanuel Raoul</span>
      <span property="givenName">Paul-Emmanuel</span>
      <span property="familyName">Raoul</span>
      <span property="alternateName">Skyper</span>
      <span property="email">skyper@skyplabs.net</span>
    </div>
  </div>


        
        <div class="post-content" property="articleBody">
          <p><a rel="noopener nofollow noreferrer" target="_blank" title="CodeQL CLI Documentation" href="https://codeql.github.com/docs/codeql-cli/">CodeQL CLI</a> includes a language server which can be easily set up
in <a rel="noopener nofollow noreferrer" target="_blank" title="coc.nvim GitHub repository" href="https://github.com/neoclide/coc.nvim">coc.nvim</a> by adding the content of this <code>coc-settings.json</code> file
to your own configuration file:</p>
<pre data-lang="json" style="background-color:#2b303b;color:#c0c5ce;" class="language-json "><code class="language-json" data-lang="json"><span>{
</span><span>  &quot;</span><span style="color:#a3be8c;">languageserver</span><span>&quot;:{
</span><span>    &quot;</span><span style="color:#a3be8c;">codeql</span><span>&quot;: {
</span><span>      &quot;</span><span style="color:#a3be8c;">command</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">codeql</span><span>&quot;,
</span><span>      &quot;</span><span style="color:#a3be8c;">args</span><span>&quot;: [
</span><span>        &quot;</span><span style="color:#a3be8c;">execute</span><span>&quot;,
</span><span>        &quot;</span><span style="color:#a3be8c;">language-server</span><span>&quot;,
</span><span>        &quot;</span><span style="color:#a3be8c;">--check-errors</span><span>&quot;,
</span><span>        &quot;</span><span style="color:#a3be8c;">ON_CHANGE</span><span>&quot;,
</span><span>        &quot;</span><span style="color:#a3be8c;">-q</span><span>&quot;
</span><span>      ],
</span><span>      &quot;</span><span style="color:#a3be8c;">filetypes</span><span>&quot;: [
</span><span>        &quot;</span><span style="color:#a3be8c;">codeql</span><span>&quot;,
</span><span>        &quot;</span><span style="color:#a3be8c;">ql</span><span>&quot;
</span><span>      ],
</span><span>      &quot;</span><span style="color:#a3be8c;">initializationOptions</span><span>&quot;: {},
</span><span>      &quot;</span><span style="color:#a3be8c;">settings</span><span>&quot;: {}
</span><span>    }
</span><span>}
</span></code></pre>
<p>Given that coc.nvim uses Vim filetype detection system and not file extensions,
you need to let Vim know about <code>*.ql</code> files being CodeQL files. One way to do
that is to add <code>codeql.vim</code> to <code>~/.vim/ftdetect</code>:</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#65737e;">&quot; Set &#39;.ql&#39; files as CodeQL files.
</span><span style="color:#96b5b4;">au </span><span>BufRead,BufNewFile </span><span style="color:#b48ead;">*.</span><span>ql </span><span style="color:#96b5b4;">set filetype</span><span>=codeql
</span></code></pre>

        </div>
        

        
  
  <span class="categories" property="keywords">
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;categories&#x2F;programming&#x2F;">Programming</a>
    
    
  </span>
  

  
  <span class="tags" property="keywords">
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;tags&#x2F;codeql&#x2F;">CodeQL</a>
     · 
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;tags&#x2F;vim&#x2F;">Vim</a>
    
    
  </span>
  

      </article>
      
      <article class="post" property="blogPost" typeof="BlogPosting">
        
  <div class="post-meta">
    
    <h2 class="post-title" property="headline">
      <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;posts&#x2F;docker-explore-from-scratch&#x2F;">
        [Docker] Explore a container's file system from scratch
      </a>
    </h2>
    

    <time class="post-date" datetime="2022-04-13 00:00"
      property="datePublished">13 Apr 2022</time>
    <div class="post-author" property="author" typeof="Person" hidden>
      <span property="name">Paul-Emmanuel Raoul</span>
      <span property="givenName">Paul-Emmanuel</span>
      <span property="familyName">Raoul</span>
      <span property="alternateName">Skyper</span>
      <span property="email">skyper@skyplabs.net</span>
    </div>
  </div>


        
        <div class="post-content" property="articleBody">
          <p>Generally, when I want to explore the file system of a Docker container, I do it
interactively by executing a shell inside it, something like:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ docker exec -it container_name sh
</span><span>$ ls
</span><span>...
</span></code></pre>
<p>But sometimes the image of the container I want to explore does not contain any
tools for this purpose. No <code>ls</code>, no <code>cat</code>, not even a shell.  It is especially
the case when building Docker images <a rel="noopener nofollow noreferrer" target="_blank" href="https://hub.docker.com/_/scratch/">from scratch</a>, which
is very common with <a rel="noopener nofollow noreferrer" target="_blank" href="https://docs.docker.com/develop/develop-images/multistage-build/">multi-stage builds</a>.</p>
<p>One solution is to rely on the <a rel="noopener nofollow noreferrer" target="_blank" href="https://docs.docker.com/engine/reference/commandline/export/"><code>docker export</code></a> tool which
allows to &quot;export a container's filesystem as a tar archive&quot;. By default, it
writes the tar archive to <code>STDOUT</code>, which means it can be easily piped into the
<code>tar</code> command-line tool to list its contents on the fly:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ docker export 7c1f2edd42c4 | tar -tv | tee filesystem.txt
</span><span>-rwxr-xr-x root/root         0 2022-04-04 09:46 .dockerenv
</span><span>drwxr-xr-x root/root         0 2022-03-19 15:52 bin/
</span><span>-rwxr-xr-x root/root  45687736 2022-03-19 15:52 bin/node
</span><span>...
</span></code></pre>

        </div>
        

        
  
  <span class="categories" property="keywords">
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;categories&#x2F;sysadmin&#x2F;">SysAdmin</a>
    
    
  </span>
  

  
  <span class="tags" property="keywords">
    
    
    <a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;tags&#x2F;docker&#x2F;">Docker</a>
    
    
  </span>
  

      </article>
      
    </div>

    <nav class="pagination">
      
      <span class="pagination-item older">← Previous</span>
      

      
      <span class="pagination-item newer"><a href="https:&#x2F;&#x2F;blog.skyplabs.net&#x2F;page&#x2F;2&#x2F;">Next →</a></span>
      
    </nav>
    
  </div>
  <script type="text/javascript" src="https://blog.skyplabs.net/elasticlunr.min.js"></script>
  <script type="text/javascript" src="https://blog.skyplabs.net/search_index.en.js"></script>
  <script type="text/javascript" src="https://blog.skyplabs.net/js/search.js"></script>
</body>
</html>
